# Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø²Ø¨Ø§Ù† (Marzban)

ÛŒÚ© Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Aiogram 3) Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…Ø§ÛŒÙ†Ø¯Ú¯Ø§Ù† (Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ø³ÙˆØ¯Ùˆ) Ø¯Ø± Ù…Ø±Ø²Ø¨Ø§Ù†ØŒ Ø¨Ø§ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù‡ÙˆØ´Ù…Ù†Ø¯ØŒ Ù‡Ø´Ø¯Ø§Ø± Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒØŒ Ùˆ Ø§Ø¹Ù…Ø§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§.

## Ú†ÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ØŸ
- Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ¯Ùˆ:
  - âž• Ø³Ø§Ø®Øª/Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒâ€ŒØ´Ø¯Ù‡ (ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±ØŒ Ø²Ù…Ø§Ù†ØŒ Ø­Ø¬Ù…)
  - âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ù†Ù„â€ŒÙ‡Ø§ØŒ ðŸ§¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ù†Ù‚Ø¶ÛŒ/Ú©Ù…â€ŒØ³Ù‡Ù…ÛŒÙ‡ØŒ â™»ï¸ Ø±ÛŒØ³Øª Ù…ØµØ±Ù
  - ðŸ“‹ Ø¯ÛŒØ¯Ù† Ù„ÛŒØ³Øª Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ù‡ Ù¾Ù†Ù„â€ŒÙ‡Ø§ØŒ ðŸ”„ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„â€ŒÙ‡Ø§
  - ðŸ’³ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´: Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ØŒ Ù¾Ù„Ù†â€ŒÙ‡Ø§ØŒ ØªØ¹Ø±ÙÙ‡ ØªÙ…Ø¯ÛŒØ¯ØŒ Ø³Øªâ€ŒÚ©Ø±Ø¯Ù† Login URL
  - ðŸ“¢ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ
- Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù…Ø¹Ù…ÙˆÙ„ÛŒ:
  - ðŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ØŒ ðŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
  - ðŸ‘¥ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ ðŸ”„ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆÙ‚ØªÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø¯Ù‡
- Ù‡ÙˆØ´Ù…Ù†Ø¯:
  - ðŸ• Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø®ÙˆØ¯Ú©Ø§Ø± (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù‡Ø± Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡)
  - âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ø¯Ø± 60%ØŒ 70%ØŒ 80%ØŒ 90% Ø¨Ø±Ø§ÛŒ Ø²Ù…Ø§Ù†/ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±/Ø­Ø¬Ù…
  - ðŸš« Ø¯Ø± 100%: ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ù†Ù„ØŒ ØªØºÛŒÛŒØ± Ù¾Ø³ÙˆØ±Ø¯ Ù¾Ù†Ù„ØŒ ØºÛŒØ±ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
  - ðŸ“¨ Ù†ÙˆØªÛŒÙ Ø¨Ù‡ Ø³ÙˆØ¯Ùˆ (Ø¨Ø§ Ù¾Ø³ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯) Ùˆ Ø¨Ù‡ Ø®ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† Ù‡Ù†Ú¯Ø§Ù… ØºÛŒØ±ÙØ¹Ø§Ù„ÛŒØŒ Ùˆ Ù‡Ù†Ú¯Ø§Ù… ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯

## Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
- ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø² BotFather
- Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø±Ø²Ø¨Ø§Ù† (URL + ÛŒÙˆØ²Ø±Ù†ÛŒÙ…/Ù¾Ø³ÙˆØ±Ø¯ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ)
- Ø¢ÛŒØ¯ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø³ÙˆØ¯Ùˆ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ (Ø§Ø² `@userinfobot` Ø¨Ú¯ÛŒØ±ÛŒØ¯)

## Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ (Ø¯Ùˆ Ø±ÙˆØ´)

### Ø±ÙˆØ´ Û±: Ø¨Ø§ Docker (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ùˆ Ø¯Ø§Ø¦Ù…ÛŒ)
1) Ú©Ù„ÙˆÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ùˆ ÙˆØ±ÙˆØ¯:
```bash
git clone https://github.com/wings-iran/Wingmarz.git
cd ADMIN
```
2) ÙØ§ÛŒÙ„ `.env` Ø¨Ø³Ø§Ø²ÛŒØ¯:
```bash
cat > .env << 'EOF'
BOT_TOKEN=123456789:AA...
MARZBAN_URL=https://panel.example.com
MARZBAN_USERNAME=admin
MARZBAN_PASSWORD=your_password
SUDO_ADMINS=111111111,222222222
MONITORING_INTERVAL=600
WARNING_THRESHOLD=0.8
AUTO_DELETE_EXPIRED_USERS=false
EOF
```
3) Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§/Ù„Ø§Ú¯ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§:
```bash
mkdir -p data logs
sudo chown -R $USER:$USER data logs
```
4) Ø§Ø¬Ø±Ø§ (Ø¯Ø§Ø¦Ù…ÛŒ Ø¨Ø§ restart):
```bash
docker compose up -d --build
```
5) Ù„Ø§Ú¯â€ŒÙ‡Ø§:
```bash
docker compose logs -f | cat
```
Ù†Ú©ØªÙ‡: Ø§Ú¯Ø± Pull Ø§ÛŒÙ…ÛŒØ¬ Ø§Ø² Docker Hub Ø®Ø·Ø§ Ø¯Ø§Ø¯ (403)ØŒ Ø¨Ø±Ø§ÛŒ Docker daemon mirror ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§ÛŒÙ…ÛŒØ¬ base Ø±Ø§ Ø¢ÙÙ„Ø§ÛŒÙ† load Ú©Ù†ÛŒØ¯.

### Ø±ÙˆØ´ Û²: Ø¨Ø¯ÙˆÙ† Docker (virtualenv + systemd Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø§Ø¦Ù…ÛŒ)
1) Ù†ØµØ¨ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§ Ùˆ Ø³Ø§Ø®Øª Ù…Ø­ÛŒØ· Ù…Ø¬Ø§Ø²ÛŒ:
```bash
sudo apt update
sudo apt install -y python3 python3-venv python3-pip
cd ~/ADMIN
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```
2) Ø³Ø§Ø®Øª `.env` Ú©Ù†Ø§Ø± Ù¾Ø±ÙˆÚ˜Ù‡ (Ù…Ø«Ù„ Ø¨Ø§Ù„Ø§).
3) ØªØ³Øª Ø§Ø¬Ø±Ø§:
```bash
python3 bot.py
```
4) Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø§Ø¦Ù…ÛŒ Ø¨Ø§ systemd:
```bash
sudo tee /etc/systemd/system/marzban-admin-bot.service > /dev/null << 'EOF'
[Unit]
Description=Marzban Admin Telegram Bot
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=%i
WorkingDirectory=/root/ADMIN
EnvironmentFile=/root/ADMIN/.env
ExecStart=/root/ADMIN/.venv/bin/python3 /root/ADMIN/bot.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl daemon-reload
sudo systemctl enable marzban-admin-bot
sudo systemctl start marzban-admin-bot
sudo systemctl status marzban-admin-bot --no-pager
journalctl -u marzban-admin-bot -f -n 200 | cat
```
ØªÙˆØ¬Ù‡: Ù…Ø³ÛŒØ±Ù‡Ø§ (`/root/ADMIN`) Ø±Ø§ Ù…Ø·Ø§Ø¨Ù‚ Ø³Ø±ÙˆØ± Ø®ÙˆØ¯Øª ØªÙ†Ø¸ÛŒÙ… Ú©Ù† Ùˆ Ù…Ø·Ù…Ø¦Ù† Ø´Ùˆ `.env` Ùˆ venv Ø¯Ø± Ù‡Ù…Ø§Ù† Ù…Ø³ÛŒØ±Ù†Ø¯.

## ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ù‡Ù…
- `.env`:
  - `BOT_TOKEN`: ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª
  - `MARZBAN_URL`: Ø¢Ø¯Ø±Ø³ Ù¾Ù†Ù„ Ù…Ø±Ø²Ø¨Ø§Ù† (https)
  - `MARZBAN_USERNAME`/`MARZBAN_PASSWORD`: Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ù…Ø±Ø²Ø¨Ø§Ù†
  - `SUDO_ADMINS`: Ø¢ÛŒØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ¯Ùˆ Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§
  - `MONITORING_INTERVAL`: Ø¨Ø§Ø²Ù‡ Ù…Ø§Ù†ÛŒØªÙˆØ± (Ø«Ø§Ù†ÛŒÙ‡)
  - `WARNING_THRESHOLD`: Ø¢Ø³ØªØ§Ù†Ù‡ Ù‡Ø´Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ù…Ø«Ù„Ø§Ù‹ 0.8)
  - `AUTO_DELETE_EXPIRED_USERS`: Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‚Ø¯ÛŒÙ…ÛŒ (true/false)

## Ø§Ø³ØªÙØ§Ø¯Ù‡
- Ø³ÙˆØ¯Ùˆ: `/start` â†’ Ù…Ù†ÙˆÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒØ´Ø¯Ù‡ (Ù¾Ù†Ù„â€ŒÙ‡Ø§ØŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒØŒ ÙØ±ÙˆØ´/Ù…Ø§Ù„ÛŒØŒ ØªÙ†Ø¸ÛŒÙ…Ø§ØªØŒ Ú¯Ø²Ø§Ø±Ø´Ø§Øª)
- Ø§Ø¯Ù…ÛŒÙ† Ù…Ø¹Ù…ÙˆÙ„ÛŒ: `/start` â†’ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ† (Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù†/Ú¯Ø²Ø§Ø±Ø´ Ù…Ù†/Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ù†/ÙØ¹Ø§Ù„Ø³Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø®Ø±ÛŒØ¯/ØªÙ…Ø¯ÛŒØ¯)

## Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ùˆ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§
- Ù‡Ø± Ø§Ø¬Ø±Ø§:
  - Ø¯Ø±ØµØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø²Ù…Ø§Ù†/Ú©Ø§Ø±Ø¨Ø±/Ø­Ø¬Ù… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
  - Ø¯Ø± 60/70/80/90% Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…ÙˆØ±Ø¯ Ù‡Ø´Ø¯Ø§Ø± Ù…ÛŒâ€ŒØ±ÙˆØ¯ (Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†).
  - Ø¯Ø± 100%: Ù¾Ù†Ù„ ØºÛŒØ±ÙØ¹Ø§Ù„ØŒ Ù¾Ø³ÙˆØ±Ø¯ Ù¾Ù†Ù„ ØªØµØ§Ø¯ÙÛŒØŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØºÛŒØ±ÙØ¹Ø§Ù„ØŒ Ù†ÙˆØªÛŒÙ Ø¨Ù‡ Ø³ÙˆØ¯Ùˆ (Ø¨Ø§ Ù¾Ø³ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯) Ùˆ Ø¨Ù‡ Ø®ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†.

## Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹
- ØªÙˆÚ©Ù† Ø¨Ø§Øª: Ù…Ù‚Ø¯Ø§Ø± `BOT_TOKEN` Ø¨Ø§ÛŒØ¯ Ø¯Ø± `.env` Ø¯Ø±Ø³Øª Ø¨Ø§Ø´Ø¯. Ø§Ú¯Ø± Â«YOUR_BOT_TOKENÂ» Ø¯ÛŒØ¯ÛŒ ÛŒØ¹Ù†ÛŒ Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡.
- Ø¯ÛŒØªØ§Ø¨ÛŒØ³: Ù…Ø³ÛŒØ± `DATABASE_PATH` (Ù¾ÛŒØ´â€ŒÙØ±Ø¶ `/app/data/bot_database.db` Ø¯Ø± Docker) Ø¨Ø§ÛŒØ¯ Ù‚Ø§Ø¨Ù„ Ù†ÙˆØ´ØªÙ† Ø¨Ø§Ø´Ø¯.
- Ù„Ø§Ú¯â€ŒÙ‡Ø§: `bot.log` Ùˆ Ù„Ø§Ú¯ Ø³Ø±ÙˆÛŒØ³/Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø±Ø§ Ú†Ú© Ú©Ù†.

## Ø­Ø°Ù Ùˆ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ
### Docker
```bash
cd ~/ADMIN
docker compose down
rm -rf data logs
```
### Systemd + venv
```bash
sudo systemctl stop marzban-admin-bot
sudo systemctl disable marzban-admin-bot
sudo rm -f /etc/systemd/system/marzban-admin-bot.service
sudo systemctl daemon-reload
cd ~
rm -rf ~/ADMIN
```

â€” Ù‡Ø± Ø¬Ø§ Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨ÙØ±Ø³Øª ØªØ§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù‡Ù…Ø§Ù† Ù…Ø±Ø­Ù„Ù‡ Ø±Ø§ Ø¨Ø±Ø§Øª Ø¯Ø±Ø³Øª Ú©Ù†ÛŒÙ…. Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´ÛŒ! ðŸš€
